{"version":3,"sources":["definedlinks/definedlinks.js"],"names":["$R","add","init","app","this","opts","component","links","onmodal","link","open","$modal","$form","definedlinks","_load","_build","ajax","get","url","success","bind","data","$selector","find","length","$body","getBody","$item","dom","append","prepend","key","html","off","hasOwnProperty","$option","val","name","on","_select","e","formData","getData","target","text","setData","Redactor"],"mappings":"CAAA,SAAUA,GAENA,EAAGC,IAAI,SAAU,eAAgB,CAC7BC,KAAM,SAASC,GAEXC,KAAKD,IAAMA,EACXC,KAAKC,KAAOF,EAAIE,KAEhBD,KAAKE,UAAYH,EAAIG,UAGrBF,KAAKG,MAAQ,IAGjBC,QAAS,CACLC,KAAM,CACFC,KAAM,SAASC,EAAQC,GAEdR,KAAKC,KAAKQ,eAEfT,KAAKO,OAASA,EACdP,KAAKQ,MAAQA,EAEbR,KAAKU,YAMvBA,MAAO,WAEmC,iBAA3BV,KAAKC,KAAKQ,aAEXT,KAAKW,OAAOX,KAAKC,KAAKQ,cAI5Bb,EAAGgB,KAAKC,IAAI,CACRC,IAAKd,KAAKC,KAAKQ,aACfM,QAASf,KAAKW,OAAOK,KAAKhB,SAItCW,OAAQ,SAASM,GAGP,GAAyB,KADrBC,EAAYlB,KAAKO,OAAOY,KAAK,4BACnBC,OACd,CACI,IAAIC,EAAQrB,KAAKO,OAAOe,UACpBC,EAAQ3B,EAAG4B,IAAI,6BACfN,EAAYtB,EAAG4B,IAAI,0CAEvBD,EAAME,OAAOP,GACbG,EAAMK,QAAQH,GAQlB,IAAK,IAAII,KALT3B,KAAKG,MAAQ,GAEbe,EAAUU,KAAK,IACfV,EAAUW,IAAI,UAEEZ,EAEZ,GAAKA,EAAKa,eAAeH,IAA6B,iBAAdV,EAAKU,GAA7C,CAKA3B,KAAKG,MAAMwB,GAAOV,EAAKU,GAEvB,IAAII,EAAUnC,EAAG4B,IAAI,YACrBO,EAAQC,IAAIL,GACZI,EAAQH,KAAKX,EAAKU,GAAKM,MAEvBf,EAAUO,OAAOM,GAGrBb,EAAUgB,GAAG,SAAUlC,KAAKmC,QAAQnB,KAAKhB,QAEnDmC,QAAS,SAASC,GAEjB,IAAIC,EAAWrC,KAAKQ,MAAM8B,UACtBX,EAAM/B,EAAG4B,IAAIY,EAAEG,QAAQP,MACvBf,EAAO,CAAEuB,KAAM,GAAI1B,IAAK,IAEhB,MAARa,IAEHV,EAAKuB,KAAOxC,KAAKG,MAAMwB,GAAKM,KAC5BhB,EAAKH,IAAMd,KAAKG,MAAMwB,GAAKb,KAGN,KAAlBuB,EAASG,OAETvB,EAAO,CAAEH,IAAKG,EAAKH,MAGvBd,KAAKQ,MAAMiC,QAAQxB,MAhGtB,CAmGGyB","file":"definedlinks.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'definedlinks', {\n        init: function(app)\n        {\n            this.app = app;\n            this.opts = app.opts;\n\n            this.component = app.component;\n\n            // local\n            this.links = [];\n        },\n        // messages\n        onmodal: {\n            link: {\n                open: function($modal, $form)\n                {\n                    if (!this.opts.definedlinks) return;\n\n                    this.$modal = $modal;\n                    this.$form = $form;\n\n                    this._load();\n                }\n            }\n\t\t},\n\n\t\t// private\n\t\t_load: function()\n\t\t{\n    \t\tif (typeof this.opts.definedlinks === 'object')\n    \t\t{\n                this._build(this.opts.definedlinks);\n    \t\t}\n            else\n            {\n        \t\t$R.ajax.get({\n            \t\turl: this.opts.definedlinks,\n            \t\tsuccess: this._build.bind(this)\n        \t\t});\n    \t\t}\n\t\t},\n\t\t_build: function(data)\n\t\t{\n            var $selector = this.$modal.find('#redactor-defined-links');\n            if ($selector.length === 0)\n            {\n                var $body = this.$modal.getBody();\n                var $item = $R.dom('<div class=\"form-item\" />');\n                var $selector = $R.dom('<select id=\"redactor-defined-links\" />');\n\n                $item.append($selector);\n                $body.prepend($item);\n            }\n\n            this.links = [];\n\n            $selector.html('');\n            $selector.off('change');\n\n            for (var key in data)\n            {\n                if (!data.hasOwnProperty(key) || typeof data[key] !== 'object')\n                {\n                    continue;\n                }\n\n                this.links[key] = data[key];\n\n                var $option = $R.dom('<option>');\n                $option.val(key);\n                $option.html(data[key].name);\n\n                $selector.append($option);\n            }\n\n            $selector.on('change', this._select.bind(this));\n\t\t},\n\t\t_select: function(e)\n\t\t{\n\t\t\tvar formData = this.$form.getData();\n\t\t\tvar key = $R.dom(e.target).val();\n\t\t\tvar data = { text: '', url: '' };\n\n\t\t\tif (key !== '0')\n\t\t\t{\n\t\t\t\tdata.text = this.links[key].name;\n\t\t\t\tdata.url = this.links[key].url;\n\t\t\t}\n\n\t\t\tif (formData.text !== '')\n\t\t\t{\n    \t\t\tdata = { url: data.url };\n\t\t\t}\n\n\t\t\tthis.$form.setData(data);\n\t\t}\n    });\n})(Redactor);"]}