{"version":3,"sources":["imagemanager/imagemanager.js"],"names":["$R","add","translations","en","choose","init","app","this","lang","opts","onmodal","image","open","$modal","$form","imageManagerJson","_load","$body","getBody","$box","dom","attr","get","addClass","hide","css","overflow","height","line-height","append","ajax","url","success","_parse","bind","data","key","obj","$img","thumb","encodeURI","JSON","stringify","width","margin","cursor","on","_insert","e","preventDefault","$el","target","parse","decodeURI","api","Redactor"],"mappings":"CAAA,SAAUA,GAENA,EAAGC,IAAI,SAAU,eAAgB,CAC7BC,aAAc,CAChBC,GAAI,CACHC,OAAU,WAGTC,KAAM,SAASC,GAEXC,KAAKD,IAAMA,EACXC,KAAKC,KAAOF,EAAIE,KAChBD,KAAKE,KAAOH,EAAIG,MAGpBC,QAAS,CACLC,MAAO,CACHC,KAAM,SAASC,EAAQC,GAEdP,KAAKE,KAAKM,kBACfR,KAAKS,MAAMH,MAM7BG,MAAO,SAASH,GAEf,IAAII,EAAQJ,EAAOK,UAEnBX,KAAKY,KAAOnB,EAAGoB,IAAI,SACnBb,KAAKY,KAAKE,KAAK,aAAcd,KAAKC,KAAKc,IAAI,WAC3Cf,KAAKY,KAAKI,SAAS,sBACnBhB,KAAKY,KAAKK,OACVjB,KAAKY,KAAKM,IAAI,CACVC,SAAU,OACVC,OAAQ,QACRC,cAAe,IAGnBX,EAAMY,OAAOtB,KAAKY,MAElBnB,EAAG8B,KAAKR,IAAI,CACLS,IAAKxB,KAAKE,KAAKM,iBACfiB,QAASzB,KAAK0B,OAAOC,KAAK3B,SAGlC0B,OAAQ,SAASE,GAEP,IAAK,IAAIC,KAAOD,EAChB,CACI,IAAIE,EAAMF,EAAKC,GACf,GAAmB,iBAARC,EAAX,CAEA,IAAIC,EAAOtC,EAAGoB,IAAI,SACdW,EAAOM,EAAS,MAAIA,EAAIE,MAAQF,EAAIN,IAExCO,EAAKjB,KAAK,MAAOU,GACjBO,EAAKjB,KAAK,cAAemB,UAAUC,KAAKC,UAAUL,KAClDC,EAAKb,IAAI,CACLkB,MAAO,OACPhB,OAAQ,OACRiB,OAAQ,cACRC,OAAQ,YAGZP,EAAKQ,GAAG,QAASvC,KAAKwC,QAAQb,KAAK3B,OAE/CA,KAAKY,KAAKU,OAAOS,MAGnBS,QAAS,SAASC,GAEdA,EAAEC,iBAEL,IAAIC,EAAMlD,EAAGoB,IAAI4B,EAAEG,QACfhB,EAAOM,KAAKW,MAAMC,UAAUH,EAAI7B,KAAK,iBAEzCd,KAAKD,IAAIgD,IAAI,sBAAuB,CAAE3C,MAAOwB,OA9EhD,CAiFGoB","file":"imagemanager.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'imagemanager', {\n        translations: {\n    \t\ten: {\n    \t\t\t\"choose\": \"Choose\"\n    \t\t}\n        },\n        init: function(app)\n        {\n            this.app = app;\n            this.lang = app.lang;\n            this.opts = app.opts;\n        },\n        // messages\n        onmodal: {\n            image: {\n                open: function($modal, $form)\n                {\n                    if (!this.opts.imageManagerJson) return;\n                    this._load($modal)\n                }\n            }\n        },\n\n\t\t// private\n\t\t_load: function($modal)\n\t\t{\n\t\t\tvar $body = $modal.getBody();\n\n\t\t\tthis.$box = $R.dom('<div>');\n\t\t\tthis.$box.attr('data-title', this.lang.get('choose'));\n\t\t\tthis.$box.addClass('redactor-modal-tab');\n\t\t\tthis.$box.hide();\n\t\t\tthis.$box.css({\n    \t\t\toverflow: 'auto',\n    \t\t\theight: '300px',\n    \t\t\t'line-height': 1\n\t\t\t});\n\n\t\t\t$body.append(this.$box);\n\n\t\t\t$R.ajax.get({\n        \t\turl: this.opts.imageManagerJson,\n        \t\tsuccess: this._parse.bind(this)\n    \t\t});\n\t\t},\n\t\t_parse: function(data)\n\t\t{\n            for (var key in data)\n            {\n                var obj = data[key];\n                if (typeof obj !== 'object') continue;\n\n                var $img = $R.dom('<img>');\n                var url = (obj.thumb) ? obj.thumb : obj.url;\n\n                $img.attr('src', url);\n                $img.attr('data-params', encodeURI(JSON.stringify(obj)));\n                $img.css({\n                    width: '96px',\n                    height: '72px',\n                    margin: '0 4px 2px 0',\n                    cursor: 'pointer'\n                });\n\n                $img.on('click', this._insert.bind(this));\n\n\t\t\t\tthis.$box.append($img);\n            }\n\t\t},\n\t\t_insert: function(e)\n\t\t{\n    \t\te.preventDefault();\n\n\t\t\tvar $el = $R.dom(e.target);\n\t\t\tvar data = JSON.parse(decodeURI($el.attr('data-params')));\n\n\t\t\tthis.app.api('module.image.insert', { image: data });\n\t\t}\n    });\n})(Redactor);"]}