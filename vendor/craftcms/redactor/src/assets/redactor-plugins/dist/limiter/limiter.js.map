{"version":3,"sources":["limiter/limiter.js"],"names":["Redactor","add","init","app","this","utils","opts","editor","keycodes","onpasting","html","limiter","removeInvisibleChars","text","_getText","len","length","input","start","_count","getElement","on","_limit","bind","stop","off","e","key","which","ctrl","ctrlKey","metaKey","BACKSPACE","DELETE","ESC","SHIFT","indexOf","preventDefault"],"mappings":"AAsFGA,SApFIC,IAAI,SAAU,UAAW,CACxBC,KAAM,SAASC,GAEXC,KAAKD,IAAMA,EACXC,KAAKC,MAAQF,EAAIE,MACjBD,KAAKE,KAAOH,EAAIG,KAChBF,KAAKG,OAASJ,EAAII,OAClBH,KAAKI,SAAWL,EAAIK,UAGxBC,UAAW,SAASC,GAEhB,GAAKN,KAAKE,KAAKK,QAAf,CAEAD,EAAON,KAAKC,MAAMO,qBAAqBF,GAEvC,IAAIG,EAAOT,KAAKU,WACZC,EAAML,EAAKM,OAASH,EAAKG,OAEtCZ,KAAKE,KAAKW,QAAUF,GAAOX,KAAKE,KAAKK,WAGhCO,MAAO,WAEPd,KAAKE,KAAKK,UACNP,KAAKe,SAESf,KAAKG,OAAOa,aAClBC,GAAG,kCAAmCjB,KAAKkB,OAAOC,KAAKnB,SAEzEoB,KAAM,WAEkBpB,KAAKG,OAAOa,aAClBK,IAAI,4BAEZrB,KAAKE,KAAKW,OAAQ,GAI5BK,OAAQ,SAASI,GAEb,IAAIC,EAAMD,EAAEE,MACXC,EAAOH,EAAEI,SAAWJ,EAAEK,QAGtBJ,IAAQvB,KAAKI,SAASwB,WACnBL,IAAQvB,KAAKI,SAASyB,QACtBN,IAAQvB,KAAKI,SAAS0B,KACtBP,IAAQvB,KAAKI,SAAS2B,OACrBN,GAAgB,KAARF,GACRE,GAAgB,KAARF,GACRE,GAAgB,KAARF,GACRE,GAAgB,MAARF,IACiB,IAVpB,CAAC,GAAI,GAAI,GAAI,IAUXS,QAAQT,IAMdvB,KAAKe,OAAOO,IAEtBP,OAAQ,SAASO,GAIhB,GAFoBtB,KAAKU,WACRE,QACJZ,KAAKE,KAAKK,QAItB,OAFgBe,GAAGA,EAAEW,iBACTjC,KAAKE,KAAKW,OAAQ,GACvB,EAIJb,KAAKE,KAAKW,OAAQ,GAGvBH,SAAU,WAEA,IACLD,EADmBT,KAAKG,OAAOa,aAChBP,OAEnB,OAAOT,KAAKC,MAAMO,qBAAqBC","file":"limiter.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'limiter', {\n        init: function(app)\n        {\n            this.app = app;\n            this.utils = app.utils;\n            this.opts = app.opts;\n            this.editor = app.editor;\n            this.keycodes = app.keycodes;\n        },\n        // events\n        onpasting: function(html)\n        {\n            if (!this.opts.limiter) return;\n\n            html = this.utils.removeInvisibleChars(html);\n\n            var text = this._getText();\n            var len = html.length + text.length;\n\n\t\t\tthis.opts.input = !(len >= this.opts.limiter);\n        },\n        // public\n        start: function()\n        {\n\t\t\tif (!this.opts.limiter) return;\n            this._count();\n\n            var $editor = this.editor.getElement();\n            $editor.on('keydown.redactor-plugin-limiter', this._limit.bind(this));\n\t\t},\n\t\tstop: function()\n\t\t{\n            var $editor = this.editor.getElement();\n            $editor.off('.redactor-plugin-limiter');\n\n            this.opts.input = true;\n\t\t},\n\n\t\t// private\n\t\t_limit: function(e)\n\t\t{\n    \t\tvar key = e.which;\n\t\t\tvar ctrl = e.ctrlKey || e.metaKey;\n\t\t\tvar arrows = [37, 38, 39, 40];\n\n\t\t\tif (key === this.keycodes.BACKSPACE\n\t\t\t   \t|| key === this.keycodes.DELETE\n\t\t\t    || key === this.keycodes.ESC\n\t\t\t    || key === this.keycodes.SHIFT\n\t\t\t    || (ctrl && key === 65)\n\t\t\t    || (ctrl && key === 88)\n\t\t\t    || (ctrl && key === 82)\n\t\t\t    || (ctrl && key === 116)\n\t\t\t    || (arrows.indexOf(key) !== -1)\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n            this._count(e);\n\t\t},\n\t\t_count: function(e)\n\t\t{\n            var text = this._getText();\n\t\t\tvar count = text.length;\n\t\t\tif (count >= this.opts.limiter)\n\t\t\t{\n                if (e) e.preventDefault();\n                this.opts.input = false;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n    \t\t\tthis.opts.input = true;\n\t\t\t}\n\t\t},\n\t\t_getText: function()\n\t\t{\n            var $editor = this.editor.getElement();\n\t\t\tvar text = $editor.text();\n\n\t\t\treturn this.utils.removeInvisibleChars(text);\n\t\t}\n    });\n})(Redactor);"]}