{"version":3,"sources":["properties/properties.js"],"names":["$R","add","modals","properties","translations","en","init","app","this","opts","lang","$body","toolbar","inspector","selection","labelStyle","font-family","position","padding","line-height","border-radius","font-size","color","onmodal","open","$modal","$form","$block","blockData","_getData","setData","opened","getField","focus","save","data","getData","_save","onbutton","observe","button","_observeButton","onclick","start","title","get","api","addButton","setIcon","_createLabel","stop","_removeLabel","block","getBlock","dom","options","width","name","handle","commands","cancel","id","removeAttr","attr","classname","_showData","str","pos","offset","$label","css","top","left","z-index","zindex","html","show","hide","append","remove","parse","isComponent","enable","disable","Redactor"],"mappings":"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","file":"properties.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'properties', {\n        modals: {\n            'properties':\n                '<form action=\"\"> \\\n                    <div class=\"form-item\"> \\\n                        <label>Id</label> \\\n                        <input type=\"text\" name=\"id\"> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label>Class</label> \\\n                        <input type=\"text\" name=\"classname\"> \\\n                    </div> \\\n                </form>'\n        },\n        translations: {\n    \t\ten: {\n    \t\t\t\"properties\": \"Properties\"\n    \t\t}\n        },\n        init: function(app)\n        {\n            this.app = app;\n            this.opts = app.opts;\n            this.lang = app.lang;\n            this.$body = app.$body;\n            this.toolbar = app.toolbar;\n            this.inspector = app.inspector;\n            this.selection = app.selection;\n\n            // local\n    \t\tthis.labelStyle = {\n        \t\t'font-family': 'monospace',\n    \t\t\t'position': 'absolute',\n    \t\t\t'padding': '2px 5px',\n    \t\t\t'line-height': 1,\n    \t\t\t'border-radius': '3px',\n    \t\t\t'font-size': '11px',\n    \t\t\t'color': 'rgba(255, 255, 255, .9)'\n    \t\t};\n        },\n        // messages\n        onmodal: {\n            properties: {\n                open: function($modal, $form)\n                {\n                    if (this.$block)\n                    {\n                        var blockData = this._getData(this.$block);\n                        $form.setData(blockData);\n                    }\n                },\n                opened: function($modal, $form)\n                {\n                    $form.getField('id').focus();\n                },\n                save: function($modal, $form)\n                {\n                    var data = $form.getData();\n                    this._save(data);\n                }\n            }\n        },\n        onbutton: {\n            properties: {\n                observe: function(button)\n                {\n                    this._observeButton(button);\n                }\n            }\n        },\n        onclick: function() {\n            //this._observeButton();\n        },\n\n        // public\n        start: function()\n        {\n            var data = {\n                title: this.lang.get('properties'),\n                api: 'plugin.properties.open',\n                observe: 'properties'\n            };\n\n            var $button = this.toolbar.addButton('properties', data);\n            $button.setIcon('<i class=\"re-icon-properties\"></i>');\n\n            this._createLabel();\n        },\n        stop: function()\n        {\n            this._removeLabel();\n        },\n        open: function()\n\t\t{\n           var block = this.selection.getBlock();\n           if (!block) return;\n\n           this.$block = $R.dom(block);\n\n           var options = {\n                title: this.lang.get('properties'),\n                width: '500px',\n                name: 'properties',\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n\n            this.app.api('module.modal.build', options);\n\t\t},\n\n\t\t// private\n\t\t_save: function(data)\n\t\t{\n    \t\tthis.app.api('module.modal.close');\n\n    \t\tif (data.id === '') this.$block.removeAttr('id');\n    \t\telse this.$block.attr('id', data.id);\n\n    \t\tif (data.classname === '') this.$block.removeAttr('class');\n    \t\telse this.$block.attr('class', data.classname);\n\t\t},\n\t\t_getData: function(block)\n\t\t{\n    \t    var $block = $R.dom(block);\n    \t    var data = {\n        \t    id: $block.attr('id'),\n        \t    classname: $block.attr('class')\n    \t    };\n\n    \t    return data;\n\t\t},\n\t\t_showData: function(block, data)\n\t\t{\n    \t\tvar str = '';\n    \t\tif (data.id) str += '#' + data.id + ' ';\n    \t\tif (data.classname) str += '.' + data.classname;\n\n\n            if (str !== '')\n            {\n                var $block = $R.dom(block);\n                var pos = $block.offset();\n\n                this.$label.css({\n                    top: (pos.top - 12) + 'px',\n                    left: pos.left + 'px',\n                    'z-index': (this.opts.zindex) ? (this.opts.zindex + 3) : 'auto'\n                });\n                this.$label.html(str);\n                this.$label.show();\n            }\n            else\n            {\n                this.$label.hide();\n            }\n\t\t},\n\t\t_createLabel: function()\n\t\t{\n            this.$label = $R.dom('<span />');\n            this.$label.hide();\n\t\t\tthis.$label.css(this.labelStyle).css('background', 'rgba(229, 57, 143, .7)');\n\n\t\t\tthis.$body.append(this.$label);\n\t\t},\n\t\t_removeLabel: function()\n\t\t{\n            if (this.$label) this.$label.remove();\n\t\t},\n\t\t_observeButton: function(button)\n\t\t{\n    \t\tvar block = this.selection.getBlock();\n    \t\tvar data = this.inspector.parse(block);\n\n    \t\tif (block && !data.isComponent())\n    \t\t{\n        \t\tvar blockData = this._getData(block);\n\n                this._showData(block, blockData);\n        \t    button.enable();\n    \t\t}\n    \t\telse\n    \t\t{\n        \t    button.disable();\n        \t    if (this.$label) this.$label.hide();\n    \t\t}\n\t\t}\n    });\n})(Redactor);"]}