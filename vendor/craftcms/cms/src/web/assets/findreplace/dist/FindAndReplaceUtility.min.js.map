{"version":3,"sources":["findreplace/src/FindAndReplaceUtility.js"],"names":["$","Craft","FindAndReplaceUtility","Garnish","Base","extend","$trigger","$form","formId","$status","addListener","this","preventDefault","onSubmit","progressBar","ev","resetProgressBar","ProgressBar","postData","getPostData","removeClass","$progressBar","velocity","params","opacity","response","proxy","expandPostArray","data","postActionRequest","action","textStatus","error","alert","updateProgressBar","setTimeout","complete","noop","$allDone","css","addClass","trigger","duration","setProgressPercentage","appendTo","trackJobProgress","cp","jQuery"],"mappings":"CAAA,SAACA,GACGC,MAAMC,sBAAwBC,QAAQC,KAAKC,OAEnCC,CACOA,SAFX,KAIUC,MAAA,KAEGD,KAAAA,SAAaE,GACbC,KAAUT,MAAEA,EAAA,IAAAQ,GAEZE,KAAAA,SAAiBH,EAAtB,eAAuCI,KAAvCJ,OATRI,KAAAF,QAAAT,EAAA,kBAAAW,KAAAJ,OAaWK,KAAAA,YAAHD,KAAAJ,MAAA,SAAA,aAGQM,SAAMC,SAAaC,GACdD,EAAAA,iBAGAA,KAALR,SAAiBU,SAAjB,cACHL,KAAAG,YAMgBH,KAAAG,YAAAE,mBAVbL,KAAKG,YAAc,IAAIb,MAAMgB,YAAYN,KAAKF,SAclCS,KAAQJ,YAAWK,aAAYC,YAAnC,UAGQT,KAAGG,YAAAO,aAAAC,SAAA,QAAAA,SACCC,CADZC,QAAA,GAKYC,CACMA,SAANzB,EAAA0B,OAAA,WACH,IAAAR,EAAAf,QAAAgB,YAAAR,KAAAJ,OATLgB,EAAStB,MAAM0B,gBAAgBT,GAaRU,EAAM,CAE7BL,OAAAA,GAjBEtB,MAAA4B,kBAAAN,EAAAO,OAAAF,EAAA5B,EAAA0B,OAAA,SAAAD,EAAAM,GALlBN,GAAAA,EAAAO,OAewBC,MAAMR,EAASO,OAetCrB,KAAAuB,oBAEsBC,WAAvBnC,EAAA0B,MAAAf,KAAA,cAAA,OACAA,MACH,CA3DTyB,SAAApC,EAAAqC,SA+DQ1B,QAIQA,KAAW2B,UACnB3B,KAAoB2B,SAAAC,IAAA,UAAA,GAGnB5B,KAAAL,SAAAkC,SAAA,YAbG7B,KAAKL,SAASmC,QAAQ,UAgBtBC,kBADiD,WAExCJ,KAAAA,YAAkBK,sBADS,MACMD,WAAU,WAAhD/B,KAAA2B,WACKhC,KAASc,SAAYpB,EAAA,4CAA1B4C,SAAAjC,KAAAF,SACKH,KAASmC,SAAQF,IAAA,UAAtB,IAJR5B,KAAKG,YAAYO,aAAaC,SAAS,CAACE,QAAS,GAAI,CAS5CqB,SAAAA,OAATT,SAAApC,EAAA0B,OAAA,WACHf,KAAA2B,SAAAhB,SAAA,CAAAE,QAAA,GAAA,CAAAkB,SAAA,SApFT/B,KAAAL,SAAAc,YAAA,YADJT,KAAAL,SAAAmC,QAAA,WAgFuB9B,QAIPV,MAAM6C,GAAGD,kBAAiB,GAAO,MApFjD,CAuFGE","file":"FindAndReplaceUtility.min.js","sourcesContent":["(function($) {\n    Craft.FindAndReplaceUtility = Garnish.Base.extend(\n        {\n            $trigger: null,\n            $form: null,\n\n            init: function(formId) {\n                this.$form = $('#' + formId);\n                this.$trigger = $('input.submit', this.$form);\n                this.$status = $('.utility-status', this.$form);\n\n                this.addListener(this.$form, 'submit', 'onSubmit');\n            },\n\n            onSubmit: function(ev) {\n                ev.preventDefault();\n\n                if (!this.$trigger.hasClass('disabled')) {\n                    if (!this.progressBar) {\n                        this.progressBar = new Craft.ProgressBar(this.$status);\n                    }\n                    else {\n                        this.progressBar.resetProgressBar();\n                    }\n\n                    this.progressBar.$progressBar.removeClass('hidden');\n\n                    this.progressBar.$progressBar.velocity('stop').velocity(\n                        {\n                            opacity: 1\n                        },\n                        {\n                            complete: $.proxy(function() {\n                                var postData = Garnish.getPostData(this.$form),\n                                    params = Craft.expandPostArray(postData);\n\n                                var data = {\n                                    params: params\n                                };\n\n                                Craft.postActionRequest(params.action, data, $.proxy(function(response, textStatus) {\n                                        if (response && response.error) {\n                                            alert(response.error);\n                                        }\n\n                                        this.updateProgressBar();\n\n                                        setTimeout($.proxy(this, 'onComplete'), 300);\n                                    }, this),\n                                    {\n                                        complete: $.noop\n                                    });\n                            }, this)\n                        });\n\n                    if (this.$allDone) {\n                        this.$allDone.css('opacity', 0);\n                    }\n\n                    this.$trigger.addClass('disabled');\n                    this.$trigger.trigger('blur');\n                }\n            },\n\n            updateProgressBar: function() {\n                var width = 100;\n                this.progressBar.setProgressPercentage(width);\n            },\n\n            onComplete: function() {\n                if (!this.$allDone) {\n                    this.$allDone = $('<div class=\"alldone\" data-icon=\"done\" />').appendTo(this.$status);\n                    this.$allDone.css('opacity', 0);\n                }\n\n                this.progressBar.$progressBar.velocity({opacity: 0}, {\n                    duration: 'fast', complete: $.proxy(function() {\n                        this.$allDone.velocity({opacity: 1}, {duration: 'fast'});\n                        this.$trigger.removeClass('disabled');\n                        this.$trigger.trigger('focus');\n                    }, this)\n                });\n\n                // Just in case the tool created a new task...\n                Craft.cp.trackJobProgress(false, true);\n            }\n        });\n})(jQuery);\n"]}