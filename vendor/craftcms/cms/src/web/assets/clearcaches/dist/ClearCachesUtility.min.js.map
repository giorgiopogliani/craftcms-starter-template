{"version":3,"sources":["clearcaches/src/ClearCachesUtility.js"],"names":["$","Craft","ClearCachesUtility","Garnish","Base","extend","$forms","formId","i","length","eq","$checkboxes","$form","find","$btn","checkInputs","filter","removeClass","addClass","on","addListener","ev","preventDefault","hasClass","this","onSubmit","progressBar","$allDone","currentTarget","$trigger","data","ProgressBar","$status","resetProgressBar","$progressBar","velocity","complete","proxy","postData","getPostData","params","expandPostArray","action","response","textStatus","postActionRequest","error","setProgressPercentage","setTimeout","appendTo","css","opacity","duration","trigger","noop"],"mappings":"CAAA,SAACA,GACGC,MAAMC,mBAAqBC,QAAQC,KAAKC,OAE5B,CACIC,KAAM,SAAKC,GAAf,IAAID,EAASN,EAAE,gBACL,IAAV,IAAiBQ,EAAGF,EAAME,EAACC,EAASA,OAAID,IAAA,CACxBF,IAAAA,EAAZA,EAAAI,GAAAF,GACeG,EAAcC,EAAAC,KAAA,wBACbC,EAAMF,EAAtBC,KAAA,QACIE,EAAc,WAAAJ,EAAWK,OAAA,YAAAP,OACTO,EAAOC,YAAYR,YAE5BK,EAAAI,SAAA,aAHXP,EAAAQ,GAAA,SAAAJ,GAQAA,IADYI,KAAGC,YAAUL,EAAzB,SAAAM,IACWA,EAAAC,iBACMV,EAAOW,SAAUF,aAC9BG,KAAAC,SAAAJ,OAKPI,SAAA,SAAAJ,GAtBT,IAgCSK,EAAAC,EAhCTf,EAAAZ,EAAAqB,EAAAO,eAyBcC,EAAajB,EAAAC,KAAA,iBACLQ,EAAGO,EAAJf,KAAb,mBAEcD,EAAMC,SAAK,cAOpBD,EAAMkB,KAAK,gBACDJ,EAAaK,EAAAA,KAAYC,eACzBN,EAAXO,mBACGN,EAAAf,EAAAkB,KAAA,aAJHJ,EAAJ,IAAAzB,MAAA8B,YAAAC,GAGIpB,EAAMkB,KAAK,cAAeJ,IAIlBA,EAASI,aAAjBb,YAAA,UAKJS,EAAYQ,aAAaC,SAAS,QAAQA,SAAS,CAFvCD,QAAAA,GAEAA,CACCE,SAAApC,EAAAqC,OAAA,WACV,IAAAC,EAAAnC,QAAAoC,YAAA3B,GACmB4B,EAAAvC,MAAWwC,gBAAAH,GAEZrC,MAAMwC,kBAAgBH,EAAnCI,OAAAF,EAAA,CAAAG,EAAAC,KAEMC,GAAyBH,EAAQF,OACnBG,MAASG,EAAOA,OAIhCpB,EAAYqB,sBAAsB,KAEvBC,WAAM,KACErB,IACEA,EAAA3B,EAAA,4CAAbiD,SAAAjB,GACaL,EAAbuB,IAAA,UAAA,GACAtC,EAAsBe,KAAtB,UAAAA,IAGQO,EAAaC,aAASA,SAAA,CAAAgB,QAAA,GAAA,CAAUC,SAAA,OAAAhB,SAAA,KAAIT,EAAAQ,SAAA,CAAAgB,QAAA,GAAA,CAAAC,SAAA,SAAAvB,EAAAZ,YAAA,YACVY,EAAAwB,QAAA,aACE,MAACD,CAAjChB,SAAApC,EAAAsD,SAEAzB,QAXZF,GAeDA,EAAAuB,IAAA,UAAA,GA1BGrB,EAAAX,SAAA,YAHdW,EAAAwB,QAAA,YAhDhB,CAoFoB1B","file":"ClearCachesUtility.min.js","sourcesContent":["(function($) {\n    Craft.ClearCachesUtility = Garnish.Base.extend(\n        {\n            init: function(formId) {\n                let $forms = $('form.utility');\n                for (let i = 0; i < $forms.length; i++) {\n                    let $form = $forms.eq(i);\n                    let $checkboxes = $form.find('input[type=checkbox]');\n                    let $btn = $form.find('.btn');\n                    let checkInputs = function() {\n                        if ($checkboxes.filter(':checked').length) {\n                            $btn.removeClass('disabled');\n                        } else {\n                            $btn.addClass('disabled');\n                        }\n                    };\n                    $checkboxes.on('change', checkInputs);\n                    checkInputs();\n                    this.addListener($form, 'submit', ev => {\n                        ev.preventDefault();\n                        if (!$btn.hasClass('disabled')) {\n                            this.onSubmit(ev);\n                        }\n                    });\n                }\n            },\n\n            onSubmit: function(ev) {\n                let $form = $(ev.currentTarget);\n                let $trigger = $form.find('button.submit');\n                let $status = $form.find('.utility-status');\n\n                if ($trigger.hasClass('disabled')) {\n                    return;\n                }\n\n                let progressBar, $allDone;\n                if (!$form.data('progressBar')) {\n                    progressBar = new Craft.ProgressBar($status);\n                    $form.data('progressBar', progressBar);\n                } else {\n                    progressBar = $form.data('progressBar');\n                    progressBar.resetProgressBar();\n                    $allDone = $form.data('allDone');\n                }\n\n                progressBar.$progressBar.removeClass('hidden');\n\n                progressBar.$progressBar.velocity('stop').velocity({\n                    opacity: 1\n                }, {\n                    complete: $.proxy(function() {\n                        let postData = Garnish.getPostData($form);\n                        let params = Craft.expandPostArray(postData);\n\n                        Craft.postActionRequest(params.action, params, (response, textStatus) => {\n                            if (response && response.error) {\n                                alert(response.error);\n                            }\n\n                            progressBar.setProgressPercentage(100);\n\n                            setTimeout(() => {\n                                if (!$allDone) {\n                                    $allDone = $('<div class=\"alldone\" data-icon=\"done\" />').appendTo($status);\n                                    $allDone.css('opacity', 0);\n                                    $form.data('allDone', $allDone);\n                                }\n\n                                progressBar.$progressBar.velocity({opacity: 0}, {\n                                    duration: 'fast', complete: () => {\n                                        $allDone.velocity({opacity: 1}, {duration: 'fast'});\n                                        $trigger.removeClass('disabled');\n                                        $trigger.trigger('focus');\n                                    },\n                                });\n                            }, 300);\n                        }, {\n                            complete: $.noop\n                        });\n                    }, this)\n                });\n\n                if ($allDone) {\n                    $allDone.css('opacity', 0);\n                }\n\n                $trigger.addClass('disabled');\n                $trigger.trigger('blur');\n            },\n        });\n})(jQuery);\n"]}