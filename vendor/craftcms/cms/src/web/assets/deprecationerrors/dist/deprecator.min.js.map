{"version":3,"sources":["deprecationerrors/src/deprecator.js"],"names":["$","Garnish","Base","extend","Deprecator","$clearAllBtn","tracesModal","init","$table","$noLogsMessage","addListener","find","this","onClearAll","Craft","postActionRequest","viewLogTraces","$tracesModalBody","ev","$container","addClass","currentTarget","empty","show","Modal","appendTo","$bod","data","textStatus","closest","proxy","response","removeClass","html","deleteLog","$tr","logId","console","log","remove","parent","jQuery"],"mappings":"CAAA,SAACA,GAkFG,IA5EiBC,QAAQC,KAAKC,OAC1B,CADAC,aAAoB,KAEhBC,OAAc,KACNC,YAFZ,KAGIA,iBAHJ,KAMUC,KAAA,WACGF,KAAAA,aAAiBL,EAAA,aACjBQ,KAAUA,OAACR,EAAA,sBACXS,KAAAA,eAAmBT,EAAxB,WAGKU,KAAAA,YAAiBF,KAAOG,aAAK,QAAgB,gBAC7CD,KAAAA,YAAiBF,KAAOG,OAAKA,KAAlC,eAAuD,QAAvD,iBAbRC,KAAAF,YAAAE,KAAAJ,OAAAG,KAAA,WAAA,QAAA,cAkBaE,aAAL,WAlBRC,MAAAC,kBAAA,2CAqBIC,KAAeH,cAGPG,cAAKC,SAAqBC,GAErBZ,GAAAA,KAALA,YAUOM,KAAAN,YAAAa,WAAAC,SAAA,WACKC,KAAAA,iBAALC,QADXV,KAAAN,YAAAiB,WAVmCC,CAClB,IAAEL,EAAAnB,EAAA,4CAAAyB,SAAAxB,QAAAyB,MADfd,KAAAK,iBAAAjB,EAAA,oCAAAyB,SAAAN,GAKKb,KAAYa,YAAWC,IAAAA,QAASI,MAArCL,EAAA,CACKF,WAAL,IAIJ,IAAIU,EAAO,CAOHC,MAAe5B,EAAAkB,EAAAG,eAAWQ,QAAA,MAAAF,KAAA,OAHlCb,MAAAC,kBAAA,+CAAAY,EAAA3B,EAAA8B,OAAA,SAAAC,EAAAH,GAxCRhB,KAAAN,YAAAa,WAAAa,YAAA,WAkDsCH,YAAfR,GAEJT,KAAAK,iBAAAgB,KAAAF,EAAAE,QAAXrB,QAIAsB,UAAA,SAAAhB,GANA,IAAIiB,EAAMnC,EAAEkB,EAAGG,eAAeQ,QAAQ,MAWlCF,EAAA,CAECS,MAAAD,EAAAR,KAAA,OA/Dbb,MAAAC,kBAAA,qCAAAY,GAAA,SAAAI,EAAAH,GAoEgBS,QAAWC,IAAA,sBAAAP,EAAAH,MAGdnB,EAAAA,WAAeuB,OACvBG,EAAAI,SA/Eb3B,KAAAC,cA2EYA,WAAY,WACRD,KAAKP,aAAamC,SAASD,SAC3B3B,KAAKJ,OAAO+B,SACZ3B,KAAKH,eAAeuB,YAAY,cA9EhD,CAmFGS","file":"deprecator.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    /**\n     * Deprecator class\n     */\n    var Deprecator = Garnish.Base.extend(\n        {\n            $clearAllBtn: null,\n            $table: null,\n            tracesModal: null,\n            $tracesModalBody: null,\n\n            init: function() {\n                this.$clearAllBtn = $('#clearall');\n                this.$table = $('#deprecationerrors');\n                this.$noLogsMessage = $('#nologs');\n\n                this.addListener(this.$clearAllBtn, 'click', 'clearAllLogs');\n                this.addListener(this.$table.find('.viewtraces'), 'click', 'viewLogTraces');\n                this.addListener(this.$table.find('.delete'), 'click', 'deleteLog');\n            },\n\n            clearAllLogs: function() {\n                Craft.postActionRequest('utilities/delete-all-deprecation-errors');\n                this.onClearAll();\n            },\n\n            viewLogTraces: function(ev) {\n                if (!this.tracesModal) {\n                    var $container = $('<div id=\"traces\" class=\"modal loading\"/>').appendTo(Garnish.$bod);\n                    this.$tracesModalBody = $('<div class=\"body\" tabindex=\"0\"/>').appendTo($container);\n\n                    this.tracesModal = new Garnish.Modal($container, {\n                        resizable: true\n                    });\n                }\n                else {\n                    this.tracesModal.$container.addClass('loading');\n                    this.$tracesModalBody.empty();\n                    this.tracesModal.show();\n                }\n\n                var data = {\n                    logId: $(ev.currentTarget).closest('tr').data('id')\n                };\n\n                Craft.postActionRequest('utilities/get-deprecation-error-traces-modal', data, $.proxy(function(response, textStatus) {\n                    this.tracesModal.$container.removeClass('loading');\n\n                    if (textStatus === 'success') {\n                        this.$tracesModalBody.html(response.html);\n                    }\n                }, this));\n            },\n\n            deleteLog: function(ev) {\n                var $tr = $(ev.currentTarget).closest('tr');\n\n                var data = {\n                    logId: $tr.data('id')\n                };\n\n                Craft.postActionRequest('utilities/delete-deprecation-error', data, function(response, textStatus) {\n                    console.log('response/textStatus', response, textStatus);\n                });\n\n                if ($tr.siblings().length) {\n                    $tr.remove();\n                }\n                else {\n                    this.onClearAll();\n                }\n            },\n\n            onClearAll: function() {\n                this.$clearAllBtn.parent().remove();\n                this.$table.remove();\n                this.$noLogsMessage.removeClass('hidden');\n            }\n        });\n\n    new Deprecator();\n})(jQuery);\n"]}