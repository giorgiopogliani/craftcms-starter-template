{"version":3,"sources":["updateswidget/src/UpdatesWidget.js"],"names":["$","Craft","UpdatesWidget","Garnish","Base","extend","$widget","$body","$btn","checking","widgetId","this","find","initBtn","checkForUpdates","addListener","dontLookLikeWereChecking","addClass","forceRefresh","removeClass","lookLikeWereChecking","total","cp","proxy","info","updateText","t","html","updateUtilitiesBadge","getUrl","jQuery"],"mappings":"CAAA,SAACA,GAEGC,MAAAC,cAAAC,QAAAC,KAAAC,OACMH,CAESI,QADX,KAEWC,MAFX,KAGUC,KAHV,KAIYC,UAJZ,EAOaH,KAAL,SAAiBI,EAAYA,GAC7BC,KAAaL,QAAAN,EAAaY,UAAKF,GAC1BG,KAALN,MAAAI,KAAAL,QAAAM,KAAA,eAAAD,KAAKE,UAGIC,GACRH,KAAAG,iBAAA,IAKIC,QAAAA,WACID,KAAAA,KAALH,KAAAJ,MAAAK,KAAA,cADJD,KAAAI,YAAAJ,KAAAH,KAAA,SAAA,WAlBRG,KAAAG,iBAAA,OA0BaN,qBAAc,WA1B3BG,KAAAF,UAAA,EA6BIO,KAAAA,QAAwBC,SAAE,WACjBR,KAALD,KAAgBS,SAAhB,aAIJH,yBAA0BI,WACbT,KAAAA,UAAU,EACfE,KAAAL,QAAAa,YAAA,YAGCC,gBAAAA,SAALF,GACSJ,KAAAA,WADTH,KAAKS,uBAOIC,MAAOC,GAAAR,gBAAAI,GAAA,EAAAlB,EAAAuB,MAAAZ,KAAA,qBAGRa,eAAJ,SAAqBA,GAIiDA,IAAKH,GAHvEI,KAAUT,2BAGAQ,EAAGvB,QAHbwB,EAIH,GAAAD,EAAAH,MAJgBpB,MAAMyB,EAAE,MAAO,yBAe5BzB,MAAAyB,EAAA,MAA4BzB,6BAAe,CAAAoB,MAAAG,EAAAH,QAT/CV,KAAKJ,MAAMoB,KACP,0BAgBCC,EACZ,+BAAA3B,MAAA4B,OAAA,qBAAA,KAAA5B,MAAAyB,EAAA,MAAA,iBAjBW,cAOJf,KAAKJ,MAAMoB,KACP,0BAA4B1B,MAAMyB,EAAE,MAAO,gCAA3C,oFACkFzB,MAAMyB,EAAE,MAAO,eAAiB,iBAGtHf,KAAKE,WAITZ,MAAMqB,GAAGM,0BA7EzB,CAgFGE","file":"UpdatesWidget.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    Craft.UpdatesWidget = Garnish.Base.extend(\n        {\n            $widget: null,\n            $body: null,\n            $btn: null,\n            checking: false,\n\n            init: function(widgetId, cached) {\n                this.$widget = $('#widget' + widgetId);\n                this.$body = this.$widget.find('.body:first');\n                this.initBtn();\n\n                if (!cached) {\n                    this.checkForUpdates(false);\n                }\n            },\n\n            initBtn: function() {\n                this.$btn = this.$body.find('.btn:first');\n                this.addListener(this.$btn, 'click', function() {\n                    this.checkForUpdates(true);\n                });\n            },\n\n            lookLikeWereChecking: function() {\n                this.checking = true;\n                this.$widget.addClass('loading');\n                this.$btn.addClass('disabled');\n            },\n\n            dontLookLikeWereChecking: function() {\n                this.checking = false;\n                this.$widget.removeClass('loading');\n            },\n\n            checkForUpdates: function(forceRefresh) {\n                if (this.checking) {\n                    return;\n                }\n\n                this.lookLikeWereChecking();\n                Craft.cp.checkForUpdates(forceRefresh, false, $.proxy(this, 'showUpdateInfo'));\n            },\n\n            showUpdateInfo: function(info) {\n                this.dontLookLikeWereChecking();\n\n                if (info.total) {\n                    var updateText;\n\n                    if (info.total == 1) {\n                        updateText = Craft.t('app', 'One update available!');\n                    }\n                    else {\n                        updateText = Craft.t('app', '{total} updates available!', {total: info.total});\n                    }\n\n                    this.$body.html(\n                        '<p class=\"centeralign\">' +\n                        updateText +\n                        ' <a class=\"go nowrap\" href=\"' + Craft.getUrl('utilities/updates') + '\">' + Craft.t('app', 'Go to Updates') + '</a>' +\n                        '</p>'\n                    );\n                }\n                else {\n                    this.$body.html(\n                        '<p class=\"centeralign\">' + Craft.t('app', 'Congrats! Youâ€™re up-to-date.') + '</p>' +\n                        '<p class=\"centeralign\"><button type=\"button\" class=\"btn\" data-icon=\"refresh\">' + Craft.t('app', 'Check again') + '</button></p>'\n                    );\n\n                    this.initBtn();\n                }\n\n                // Update the CP header badge\n                Craft.cp.updateUtilitiesBadge();\n            }\n        });\n})(jQuery);\n"]}