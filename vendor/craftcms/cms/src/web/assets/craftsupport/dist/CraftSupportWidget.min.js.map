{"version":3,"sources":["craftsupport/src/CraftSupportWidget.js"],"names":["$","Craft","CraftSupportWidget","Garnish","Base","extend","widgetId","envInfo","loading","$widget","$pane","$currentScreen","$nextScreen","$helpBody","$feedbackBody","widgets","this","screens","screen","find","$screens","filter","initScreen","SCREEN_HOME","$screen","getScreen","loadScreen","reinit","SCREEN_FEEDBACK","HomeScreen","SCREEN_HELP","HelpScreen","FeedbackScreen","gotoScreen","velocity","handleScreenAnimationComplete","css","opacity","display","left","top","width","height","outerHeight","proxy","currentScreen","position","BaseScreen","init","widget","afterInit","noop","$options","handleOptionClick","attr","BaseSearchScreen","$formContainer","children","addListener","$searchResults","ev","currentTarget","$searchParams","$supportForm","$supportMessage","$supportAttachment","$supportSubmit","$supportSpinner","$supportErrorList","sendingSupportTicket","$body","$searchSubmit","$searchResultsContainer","$searchForm","$more","trigger","$supportIframe","prepForSearch","handleSearchFormSubmit","preventDefault","handleBodyTextChange","mode","MODE_SEARCH","clearSearchTimeout","searchTimeout","params","bodyStartHeight","getFormParams","text","name","hasOwnProperty","appendTo","removeClass","val","setTimeout","html","addClass","type","value","RETURN_KEY","isCtrlKeyPressed","handleBodyKeydown","keyCode","ESC_KEY","success","clearTimeout","handleSearchSuccess","response","search","results","showingResults","getSearchUrl","startResultsHeight","url","error","hideSearchResults","i","append","getSearchResults","length","endResultsHeight","max","href","getSearchResultUrl","getSearchResultStatus","getSearchResultText","complete","remove","handleSupportFormSubmit","MODE_SUPPORT","swapForms","$out","animate","prepForSupport","$in","attribute","errors","displayNotice","t","parseSupportResponse","insertAfter","query","cp","items","title","result","state","encodeURIComponent","link","is_answered","body","html_url","jQuery"],"mappings":"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","file":"CraftSupportWidget.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    Craft.CraftSupportWidget = Garnish.Base.extend(\n        {\n            widgetId: 0,\n            envInfo: null,\n            loading: false,\n\n            $widget: null,\n            $pane: null,\n            $screens: null,\n            $currentScreen: null,\n            $nextScreen: null,\n\n            screens: null,\n            currentScreen: null,\n            $helpBody: null,\n            $feedbackBody: null,\n\n            init: function(widgetId, envInfo) {\n                this.widgetId = widgetId;\n                this.envInfo = envInfo;\n\n                Craft.CraftSupportWidget.widgets[this.widgetId] = this;\n\n                this.$widget = $('#widget' + widgetId);\n                this.$pane = this.$widget.find('> .front > .pane');\n                this.$screens = this.$pane.find('> .body > .cs-screen');\n\n                this.screens = {};\n                this.$currentScreen = this.initScreen(Craft.CraftSupportWidget.SCREEN_HOME).$screen;\n            },\n\n            getScreen: function(screen) {\n                return this.$screens.filter('.cs-screen-' + screen + ':first');\n            },\n\n            initScreen: function(screen) {\n                // First time?\n                if (typeof this.screens[screen] === 'undefined') {\n                    this.screens[screen] = this.loadScreen(screen);\n                } else {\n                    this.screens[screen].reinit();\n                }\n\n                return this.screens[screen];\n            },\n\n            loadScreen: function(screen) {\n                var $screen = this.getScreen(screen);\n\n                switch (screen) {\n                    case Craft.CraftSupportWidget.SCREEN_HOME:\n                        return new HomeScreen(this, screen, $screen);\n                    case Craft.CraftSupportWidget.SCREEN_HELP:\n                        return new HelpScreen(this, screen, $screen);\n                    case Craft.CraftSupportWidget.SCREEN_FEEDBACK:\n                        return new FeedbackScreen(this, screen, $screen);\n                    default:\n                        throw 'Invalid screen: ' + screen;\n                }\n            },\n\n            gotoScreen: function(screen) {\n                // Are we right in the middle of a transition?\n                if (this.$nextScreen) {\n                    // Unfortunately velocity('finish') doesn't work fast enough\n                    this.$currentScreen\n                        .velocity('stop')\n                        .css({opacity: 0, display: 'none'});\n                    this.$nextScreen\n                        .velocity('stop')\n                        .css({opacity: 1});\n                    this.$pane.velocity('stop');\n                    this.handleScreenAnimationComplete();\n                }\n\n                // Init/prep the next screen\n                this.$nextScreen = this.getScreen(screen)\n                    .css({\n                        display: 'block',\n                        position: 'absolute',\n                        left: '0px',\n                        top: '0px',\n                        width: this.$pane.width() + 'px'\n                    });\n\n                // Animate the new screen into view\n                this.$pane.height(this.$pane.height());\n                this.$currentScreen.velocity({opacity: 0}, {display: 'none'});\n                this.$nextScreen.velocity({opacity: 1});\n                this.$pane.velocity({height: this.$nextScreen.outerHeight()}, {\n                    complete: $.proxy(this, 'handleScreenAnimationComplete')\n                });\n\n                this.currentScreen = this.initScreen(screen);\n            },\n\n            handleScreenAnimationComplete: function() {\n                this.$pane.height('auto');\n                this.$nextScreen.css({\n                    position: 'relative',\n                    width: 'auto'\n                });\n                this.$currentScreen = this.$nextScreen;\n                this.$nextScreen = null;\n            }\n        },\n        {\n            widgets: {},\n            SCREEN_HOME: 'home',\n            SCREEN_HELP: 'help',\n            SCREEN_FEEDBACK: 'feedback'\n        });\n\n    var BaseScreen = Garnish.Base.extend(\n        {\n            widget: null,\n            screen: null,\n            $screen: null,\n\n            init: function(widget, screen, $screen) {\n                this.widget = widget;\n                this.screen = screen;\n                this.$screen = $screen;\n\n                this.afterInit();\n            },\n\n            afterInit: $.noop,\n            reinit: $.noop\n        });\n\n    var HomeScreen = BaseScreen.extend(\n        {\n            afterInit: function() {\n                var $options = this.$screen.children('.cs-opt');\n                this.addListener($options, 'click', 'handleOptionClick');\n            },\n\n            handleOptionClick: function(ev) {\n                var screen = $.attr(ev.currentTarget, 'data-screen');\n                this.widget.gotoScreen(screen);\n            }\n        });\n\n    var BaseSearchScreen = BaseScreen.extend(\n        {\n            $body: null,\n            $formContainer: null,\n            mode: null,\n            bodyStartHeight: null,\n\n            $searchResultsContainer: null,\n            $searchResults: null,\n            $searchForm: null,\n            $searchParams: null,\n            $searchSubmit: null,\n            searchTimeout: null,\n            showingResults: false,\n\n            $supportForm: null,\n            $supportMessage: null,\n            $supportAttachment: null,\n            $supportSubmit: null,\n            $supportSpinner: null,\n            $supportErrorList: null,\n            $supportIframe: null,\n            sendingSupportTicket: false,\n\n            afterInit: function() {\n                this.$body = this.$screen.find('.cs-body-text:first').trigger('focus');\n                this.$formContainer = this.$screen.children('.cs-forms');\n\n                // Search mode stuff\n                this.$searchResultsContainer = this.$screen.children('.cs-search-results-container:first');\n                this.$searchResults = this.$searchResultsContainer.find('.cs-search-results:first');\n                this.$searchForm = this.$formContainer.children('.cs-search-form:first');\n                this.$searchParams = this.$searchForm.children('.cs-search-params:first');\n                this.$searchSubmit = this.$searchForm.children('.submit:first');\n                this.addListener(this.$searchForm, 'submit', 'handleSearchFormSubmit');\n                this.addListener(this.$searchForm.find('> p > a'), 'click', 'handleSupportLinkClick');\n\n                // Support mode stuff\n                this.$supportForm = this.$formContainer.children('.cs-support-form:first');\n                this.$supportMessage = this.$supportForm.children('input.cs-support-message');\n                var $more = this.$supportForm.children('.cs-support-more');\n                this.$supportAttachment = $more.find('.cs-support-attachment:first');\n                this.$supportSubmit = this.$supportForm.children('.submit:first');\n                this.$supportSpinner = this.$supportForm.children('.spinner:first');\n                this.$supportIframe = this.$screen.children('iframe');\n                this.addListener(this.$supportForm, 'submit', 'handleSupportFormSubmit');\n\n                this.bodyStartHeight = this.$body.height();\n                this.addListener(this.$body, 'input', 'handleBodyTextChange');\n                this.addListener(this.$body, 'keydown', 'handleBodyKeydown');\n                this.prepForSearch(false);\n            },\n\n            handleSearchFormSubmit: function(ev) {\n                if (!this.$body.val()) {\n                    ev.preventDefault();\n                }\n            },\n\n            handleBodyTextChange: function() {\n                var text = this.$body.val();\n\n                if (this.mode === BaseSearchScreen.MODE_SEARCH) {\n                    this.clearSearchTimeout();\n                    this.searchTimeout = setTimeout($.proxy(this, 'search'), 500);\n\n                    if (text) {\n                        this.$searchParams.html('');\n                        var params = this.getFormParams(text);\n                        for (var name in params) {\n                            if (params.hasOwnProperty(name)) {\n                                $('<input/>', {\n                                    type: 'hidden',\n                                    name: name,\n                                    value: params[name]\n                                }).appendTo(this.$searchParams);\n                            }\n                        }\n                        this.$searchSubmit.removeClass('disabled');\n                    } else {\n                        this.$searchSubmit.addClass('disabled');\n                    }\n                } else {\n                    if (text) {\n                        this.$supportMessage.val(text);\n                        this.$supportSubmit.removeClass('disabled');\n                    } else {\n                        this.$supportSubmit.addClass('disabled');\n                    }\n                }\n            },\n\n            handleBodyKeydown: function(ev) {\n                switch (ev.keyCode) {\n                    case Garnish.ESC_KEY:\n                        if (this.mode === BaseSearchScreen.MODE_SEARCH) {\n                            this.widget.gotoScreen(Craft.CraftSupportWidget.SCREEN_HOME);\n                        } else if (!this.sendingSupportTicket) {\n                            this.prepForSearch(true);\n                        }\n                        break;\n                    case Garnish.RETURN_KEY:\n                        if (Garnish.isCtrlKeyPressed(ev)) {\n                            if (this.mode === BaseSearchScreen.MODE_SEARCH) {\n                                this.$searchForm.trigger('submit');\n                            } else {\n                                this.$supportForm.trigger('submit');\n                            }\n                        }\n                        break;\n                }\n            },\n\n            handleSupportLinkClick: function() {\n                this.prepForSupport(true);\n            },\n\n            clearSearchTimeout: function() {\n                if (this.searchTimeout) {\n                    clearTimeout(this.searchTimeout);\n                    this.searchTimeout = null;\n                }\n            },\n\n            search: function() {\n                this.clearSearchTimeout();\n\n                var text = this.$body.val();\n\n                if (text) {\n                    var url = this.getSearchUrl(this.$body.val());\n                    $.ajax({\n                        url: url,\n                        dataType: 'json',\n                        success: $.proxy(this, 'handleSearchSuccess'),\n                        error: $.proxy(this, 'hideSearchResults')\n                    });\n                } else {\n                    this.hideSearchResults();\n                }\n            },\n\n            handleSearchSuccess: function(response) {\n                if (this.mode !== BaseSearchScreen.MODE_SEARCH) {\n                    return;\n                }\n\n                var results = this.getSearchResults(response);\n\n                if (results.length) {\n                    var startResultsHeight;\n\n                    if (!this.showingResults) {\n                        this.$searchResultsContainer.removeClass('hidden');\n                        startResultsHeight = 0;\n                        this.showingResults = true;\n                        this.$screen.addClass('with-results');\n                    } else {\n                        startResultsHeight = this.$searchResultsContainer.height();\n                    }\n\n                    this.$searchResults.html('');\n\n                    var max = Math.min(results.length, 20);\n                    for (var i = 0; i < max; i++) {\n                        this.$searchResults.append($('<li>').append($('<a>', {\n                            href: this.getSearchResultUrl(results[i]),\n                            target: '_blank',\n                            html: '<span class=\"status ' + this.getSearchResultStatus(results[i]) + '\"></span>' + this.getSearchResultText(results[i])\n                        })));\n                    }\n\n                    var endResultsHeight = this.$searchResultsContainer.height('auto').height();\n                    this.$searchResultsContainer\n                        .velocity('stop')\n                        .height(startResultsHeight)\n                        .velocity(\n                            {height: endResultsHeight},\n                            {\n                                complete: $.proxy(function() {\n                                    this.$searchResultsContainer.height('auto');\n                                }, this)\n                            });\n                } else {\n                    this.hideSearchResults();\n                }\n            },\n\n            hideSearchResults: function() {\n                if (this.mode !== BaseSearchScreen.MODE_SEARCH || !this.showingResults) {\n                    return;\n                }\n\n                this.$searchResultsContainer\n                    .velocity('stop')\n                    .height(this.$searchResultsContainer.height())\n                    .velocity(\n                        {height: 0},\n                        {\n                            complete: $.proxy(function() {\n                                this.$searchResultsContainer.addClass('hidden');\n                            }, this)\n                        });\n\n                this.showingResults = false;\n                this.$screen.removeClass('with-results');\n            },\n\n            handleSupportFormSubmit: function(ev) {\n                if (!this.$body.val() || this.sendingSupportTicket) {\n                    ev.preventDefault();\n                    return;\n                }\n\n                this.sendingSupportTicket = true;\n                this.$supportSubmit.addClass('active');\n                this.$supportSpinner.removeClass('hidden');\n            },\n\n            reinit: function() {\n                this.$body.trigger('focus');\n            },\n\n            prepForSearch: function(animate) {\n                this.mode = BaseSearchScreen.MODE_SEARCH;\n\n                this.$body\n                    .velocity('stop')\n                    .trigger('focus');\n\n                if (this.$supportErrorList) {\n                    this.$supportErrorList.remove();\n                    this.$supportErrorList = null;\n                }\n\n                if (animate) {\n                    this.$body.velocity({height: this.bodyStartHeight});\n                } else {\n                    this.$body.height(this.bodyStartHeight);\n                }\n\n                this.swapForms(this.$supportForm, this.$searchForm, animate);\n\n                // In case there's already a search value\n                this.handleBodyTextChange();\n                this.search();\n            },\n\n            prepForSupport: function(animate) {\n                this.clearSearchTimeout();\n                this.hideSearchResults();\n\n                this.mode = BaseSearchScreen.MODE_SUPPORT;\n\n                this.$body\n                    .velocity('stop')\n                    .trigger('focus');\n\n                if (animate) {\n                    this.$body.velocity({height: this.bodyStartHeight * 2});\n                } else {\n                    this.$body.height(this.bodyStartHeight * 2);\n                }\n\n                this.swapForms(this.$searchForm, this.$supportForm, animate);\n\n                // In case there's already a search value\n                this.handleBodyTextChange();\n            },\n\n            swapForms: function($out, $in, animate) {\n                if (animate) {\n                    this.$formContainer.height(this.$formContainer.height());\n                    var width = this.$formContainer.width();\n\n                    $out\n                        .velocity('stop')\n                        .css({position: 'absolute', top: 0, left: 0, width: width})\n                        .velocity(\n                            {opacity: 0},\n                            {\n                                complete: function() {\n                                    $out\n                                        .addClass('hidden')\n                                        .css({position: 'relative', width: 'auto'});\n                                }\n                            });\n\n                    $in\n                        .velocity('stop')\n                        .removeClass('hidden')\n                        .css({position: 'absolute', top: 0, left: 0, width: width})\n                        .velocity(\n                            {opacity: 1},\n                            {\n                                complete: function() {\n                                    $in.css({position: 'relative', width: 'auto'});\n                                }\n                            });\n\n                    this.$formContainer\n                        .velocity('stop')\n                        .velocity(\n                            {height: $in.height()},\n                            {\n                                complete: $.proxy(function() {\n                                    this.$formContainer.css({height: 'auto'});\n                                }, this)\n                            }\n                        );\n                } else {\n                    $out.addClass('hidden');\n                    $in.removeClass('hidden');\n                }\n            },\n\n            parseSupportResponse: function(response) {\n                this.sendingSupportTicket = false;\n                this.$supportSubmit.removeClass('active');\n                this.$supportSpinner.addClass('hidden');\n\n                if (this.$supportErrorList) {\n                    this.$supportErrorList.children().remove();\n                }\n\n                if (response.errors) {\n                    if (!this.$supportErrorList) {\n                        this.$supportErrorList = $('<ul class=\"errors\"/>').insertAfter(this.$supportForm);\n                    }\n\n                    for (var attribute in response.errors) {\n                        if (response.errors.hasOwnProperty(attribute)) {\n                            for (var i = 0; i < response.errors[attribute].length; i++) {\n                                var error = response.errors[attribute][i];\n                                $('<li>' + error + '</li>').appendTo(this.$supportErrorList);\n                            }\n                        }\n                    }\n                }\n\n                if (response.success) {\n                    Craft.cp.displayNotice(Craft.t('app', 'Message sent successfully.'));\n                    this.$body.val('');\n                    this.$supportMessage.val('');\n                    this.$supportAttachment.val('');\n                }\n\n                this.$supportIframe.html('');\n            },\n\n            getFormParams: function() {\n                throw 'getFormParams() must be implemented';\n            },\n            getSearchUrl: function() {\n                throw 'getSearchUrl() must be implemented';\n            },\n            getSearchResults: function() {\n                throw 'getSearchResults() must be implemented';\n            },\n            getSearchResultUrl: function() {\n                throw 'getSearchResultUrl() must be implemented';\n            },\n            getSearchResultStatus: function() {\n                throw 'getSearchResultStatus() must be implemented';\n            },\n            getSearchResultText: function() {\n                throw 'getSearchResultUrl() must be implemented';\n            }\n        }, {\n            MODE_SEARCH: 'search',\n            MODE_SUPPORT: 'support'\n        });\n\n    var HelpScreen = BaseSearchScreen.extend(\n        {\n            getFormParams: function(query) {\n                return {title: query};\n            },\n\n            getSearchUrl: function(query) {\n                return 'https://api.stackexchange.com/2.2/similar?site=craftcms&sort=relevance&order=desc&title=' + encodeURIComponent(query);\n            },\n\n            getSearchResults: function(response) {\n                return response.items || [];\n            },\n\n            getSearchResultUrl: function(result) {\n                return result.link;\n            },\n\n            getSearchResultStatus: function(result) {\n                return result.is_answered ? 'green' : '';\n            },\n\n            getSearchResultText: function(result) {\n                return result.title;\n            }\n        });\n\n    var FeedbackScreen = BaseSearchScreen.extend(\n        {\n            getFormParams: function(query) {\n                var body = \"### Description\\n\\n\\n\\n\" +\n                    \"### Steps to reproduce\\n\\n\" +\n                    \"1.\\n\" +\n                    \"2.\\n\\n\" +\n                    \"### Additional info\\n\";\n\n                for (var name in this.widget.envInfo) {\n                    if (this.widget.envInfo.hasOwnProperty(name)) {\n                        body += \"\\n- \" + name + ': ' + this.widget.envInfo[name];\n                    }\n                }\n\n                return {title: query, body: body};\n            },\n\n            getSearchUrl: function(query) {\n                return 'https://api.github.com/search/issues?q=type:issue+repo:craftcms/cms+' + encodeURIComponent(query);\n            },\n\n            getSearchResults: function(response) {\n                return response.items || [];\n            },\n\n            getSearchResultUrl: function(result) {\n                return result.html_url;\n            },\n\n            getSearchResultStatus: function(result) {\n                return result.state === 'open' ? 'green' : 'red';\n            },\n\n            getSearchResultText: function(result) {\n                return result.title;\n            }\n        });\n})(jQuery);\n"]}